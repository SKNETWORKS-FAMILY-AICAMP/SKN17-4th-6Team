{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>íšŒì› íƒˆí‡´ | Auto FIX</title>

<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background-color: #F8F9FE;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }

  .logo {
    position: absolute;
    top: 40px;
    left: 90px;
    font-size: 50px;
    font-weight: 700;
    color: #B3BFE9;
    cursor: pointer;
  }

  /* ğŸ”¹ ë¡œê·¸ì¸ í˜ì´ì§€ì™€ ë™ì¼í•œ ì¹´ë“œ ë ˆì´ì•„ì›ƒ */
  .withdraw-container {
    background-color: #ffffff;
    padding: 50px 40px;
    border-radius: 20px;
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.04);
    width: 400px;
    min-height: 500px; /* âœ… ìµœì†Œ ë†’ì´ ê³ ì • (í°íŠ¸ ì¤„ì—¬ë„ ì•ˆì •) */
    text-align: center;
    display: flex;
    flex-direction: column;
    justify-content: center; /* ë‚´ë¶€ ì¤‘ì•™ì •ë ¬ */
  }

  .withdraw-container h1 {
    font-size: 45px; /* ë¡œê·¸ì¸ ì œëª©ë³´ë‹¤ ì•½ê°„ ì‘ê²Œ */
    font-weight: 900;
    color: #55609a;
    margin-bottom: 40px; /* ì•„ë˜ ì—¬ë°± ëŠ˜ë ¤ ê· í˜• ë§ì¶¤ */
  }

  .withdraw-form {
    width: 100%;
    display: flex;
    flex-direction: column;
  }

  /* ğŸ”¹ ì¸í’‹ ìŠ¤íƒ€ì¼ ë¡œê·¸ì¸ í˜ì´ì§€ì™€ ë™ì¼ */
  .withdraw-form input[type="password"] {
    width: 100%;
    padding: 16px 18px;
    margin-bottom: 18px;
    border: 1px solid #55609a;
    border-radius: 10px;
    font-size: 15px;
    color: #333;
    outline: none;
    transition: border-color 0.2s ease;
  }

  .withdraw-form input[type="password"]:focus {
    border-color: #9ea2f0;
  }

  .withdraw-form input::placeholder {
    color: #A0A5B4;
    font-size: 15px;
  }

  /* ğŸ”¹ í”¼ë“œë°± ê³µê°„ ê³ ì • (ë ˆì´ì•„ì›ƒ í”ë“¤ë¦¼ ë°©ì§€) */
  #password-feedback {
    min-height: 18px;
    color: red;
    font-size: 14px;
    margin: 2px 0 10px;
    text-align: left;
  }

  /* ğŸ”¹ íƒˆí‡´ ë²„íŠ¼ */
  .delete-btn {
    width: 50%;
    padding: 10px;
    border: none;
    border-radius: 16px;
    font-size: 16px;
    font-weight: Regular;
    cursor: pointer;
    background: #FF4B4B;
    color: #fff;
    transition: background-color 0.3s ease;
    margin-top: 15px;
    align-self: flex-end;
  }

  .delete-btn:hover {
    background: #e03b3b;
  }

  @media (max-width: 768px) {
    .withdraw-container {
      width: 90%;
      padding: 40px 25px;
    }
    .withdraw-container h1 {
      font-size: 36px;
    }
  }
</style>
</head>

<body>
  <div class="logo" id="logo">&lt;</div>

  <div class="withdraw-container">
    <h1>íšŒì› íƒˆí‡´</h1>

    <form class="withdraw-form" id="withdrawForm">
      {% csrf_token %}
      <input type="password" name="password1" id="password1"
             placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”."
             value="{{ form.password1.value|default:'' }}">
      <input type="password" name="password2" id="password2"
             placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸"
             value="{{ form.password2.value|default:'' }}">
      <div id="password-feedback"></div>
      <button type="button" class="delete-btn" id="deleteBtn">íƒˆí‡´</button>
    </form>
  </div>

  <script>
    document.getElementById("logo").addEventListener("click", () => {
      window.location.href = "{% url 'chat:main' %}";
    });

    document.addEventListener('DOMContentLoaded', () => {
      const pw1 = document.getElementById('password1');
      const pw2 = document.getElementById('password2');
      const feedback = document.getElementById('password-feedback');
      const deleteBtn = document.getElementById('deleteBtn');
      const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

      function updateFeedback() {
        if (pw1.value && pw2.value && pw1.value !== pw2.value) {
          feedback.innerHTML = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
        } else {
          feedback.innerHTML = "";
        }
      }

      pw1.addEventListener('input', updateFeedback);
      pw2.addEventListener('input', updateFeedback);

      deleteBtn.addEventListener('click', async () => {
        if (pw1.value !== pw2.value) {
          alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
          return;
        }

        if (!confirm("ì •ë§ë¡œ íšŒì›íƒˆí‡´ í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) return;

        try {
          const response = await fetch("{% url 'uauth:delete_account' %}", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "X-CSRFToken": csrfToken,
            },
            body: JSON.stringify({ password: pw1.value }),
          });

          const result = await response.json();

          if (!response.ok) {
            alert(result.message || "íšŒì›íƒˆí‡´ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            return;
          }

          alert(result.message || "íšŒì›íƒˆí‡´ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
          window.location.href = "/chat/main";
        } catch (err) {
          console.error(err);
          alert("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        }
      });
    });
  </script>
</body>
</html>
